# File: .github/workflows/n1ghtly-status.yml
# Purpose: write / update status.json on gh-pages twice a day
# ─────────────────────────────────────────────────────────────────
name: n1ghtly-status

on:
  schedule:
    - cron:  '13 03 * * *'   # 03:13  UTC  (≈ late evening U.S.)
    - cron:  '13 15 * * *'   # 15:13  UTC  (≈ morning U.S.)
  workflow_dispatch:

permissions:
  contents: write            # enables default GITHUB_TOKEN to push

jobs:
  snapshot:
    runs-on: ubuntu-latest

    steps:
      # 1 ▸ Checkout *gh-pages* with full history so we’re up-to-date
      - uses: actions/checkout@v4
        with:
          ref: gh-pages
          fetch-depth: 0

      # 2 ▸ Create / overwrite status.json
      - name: Generate status.json
        shell: bash
        run: |
          ts="$(date -u +'%Y-%m-%dT%H:%M:%SZ')"
          echo "{ \"generated\": \"${ts}\" }" > status.json

      # 3 ▸ Commit & push (fast-forward or new commit on top)
      - name: Commit & push to gh-pages
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "auto: publish status snapshot ${{ github.run_id }}"
          branch: gh-pages
          file_pattern: status.json
