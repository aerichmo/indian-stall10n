name: n1ghtly-status         # note the “1” to avoid name clash
on:
  schedule:
    # ┌────────┬────────┬────────┬────────┬────────┐
    # │ minute │  hour  │  dom   │ month  │ dow    │
    # └────────┴────────┴────────┴────────┴────────┘
    # 05:00 UTC and 17:00 UTC  →   ~mid-morning & evening US-Central
    - cron:  "0 5,17 * * *"

  workflow_dispatch:          # allow you to run it manually
concurrency:                  # never let two runs overlap
  group: n1ghtly-status
  cancel-in-progress: false

jobs:
  ingest-and-publish:
    runs-on: ubuntu-latest

    steps:
    - name: 📥  Check out repository
      uses: actions/checkout@v4

    - name: 🐍  Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.11"

    - name: 🔄  Install deps
      run: |
        python -m pip install --quiet requests

    - name: 🚚  Pull racing feeds and build status.json
      env:
        API_USER: ${{ secrets.RACING_API_USER }}
        API_PASS: ${{ secrets.RACING_API_PASS }}
      run: |
        python scripts/ingest.py                      # <- you will add this file
        echo "Updated raw feeds and status.json"

    - name: 🚀  Push to gh-pages
      uses: ad-m/github-push-action@v0.6.0
      with:
        github_token: ${{ secrets.GH_PAGES_PUBLISHER_KEY }}
        branch: gh-pages
        # Commit all changed files (raw/*.json, status.json)
